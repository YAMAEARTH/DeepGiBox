# ═══════════════════════════════════════════════════════════════════════════
# DeepGiBox Runner Configuration - Hardware Internal Keying Pipeline
# ═══════════════════════════════════════════════════════════════════════════
# Full production pipeline with real-time overlay output via DeckLink hardware keying
# Pipeline: Capture → Preprocess → Inference → Postprocess → Overlay → Hardware Keying

mode = "hardware_keying"

# ═══════════════════════════════════════════════════════════════════════════
# GENERAL SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[general]
# Test duration in seconds (0 = unlimited, run until Ctrl+C)
test_duration_seconds = 0
# Enable debug dumps (saves frames, detections to output/runner/)
enable_debug_dumps = false
# Number of frames to dump (if debug enabled)
debug_dump_frame_count = 5
# Print statistics every N frames
stats_print_interval = 60

# ═══════════════════════════════════════════════════════════════════════════
# CAPTURE SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[capture]
# DeckLink device index (0 = first device)
device_index = 0
# Expected input resolution (for auto-configuration)
expected_resolution = "1080p60"

# ═══════════════════════════════════════════════════════════════════════════
# PREPROCESSING SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[preprocessing]
# Model input size (must match trained model)
output_width = 512
output_height = 512
# Use FP16 precision (false = FP32)
use_fp16 = false
# CUDA device ID
cuda_device = 0
# Normalization parameters
mean = [0.0, 0.0, 0.0]
std = [1.0, 1.0, 1.0]
# YUV422 chroma order: "UYVY" or "YUYV"
chroma_order = "UYVY"
# Crop region preset: "Olympus", "Pentax", "Fuji", or "None"
crop_region = "Olympus"

# ═══════════════════════════════════════════════════════════════════════════
# INFERENCE SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[inference]
# TensorRT engine path (must be pre-built)
engine_path = "configs/model/v7_optimized_YOLOv5.engine"
# TRT shim library path
lib_path = "trt-shim/build/libtrt_shim.so"

# ═══════════════════════════════════════════════════════════════════════════
# POSTPROCESSING SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[postprocessing]
# Number of output classes
num_classes = 2
# Confidence threshold for detections
confidence_threshold = 0.25
# NMS IoU threshold
nms_threshold = 0.45
# Maximum number of detections to keep (0 = unlimited)
max_detections = 100

# Temporal smoothing (stabilizes bounding boxes across frames)
[postprocessing.temporal_smoothing]
enable = true
window_size = 4

# SORT object tracking
[postprocessing.tracking]
enable = true
max_age = 30
min_confidence = 0.3
iou_threshold = 0.3

# ═══════════════════════════════════════════════════════════════════════════
# OVERLAY SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[overlay]
# Enable full UI mode (HUD, confidence bars, etc.)
enable_full_ui = true

# Bounding box appearance
[overlay.bbox]
base_thickness = 2
corner_length_factor = 0.22
corner_min_length = 18.0
corner_max_length = 40.0
corner_thickness = 3

# Label appearance
[overlay.label]
font_size = 16
show_confidence = true
show_track_id = true
label_offset_y = 10.0

# ═══════════════════════════════════════════════════════════════════════════
# RENDERING SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[rendering]
# Font file path (optional, uses embedded font if not specified)
# font_path = "testsupport/DejaVuSans.ttf"
text_antialiasing = true
# Enable debug rendering messages (prints [DEBUG] overlay operation details)
debug_rendering = false

# ═══════════════════════════════════════════════════════════════════════════
# HARDWARE KEYING SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[keying]
# Enable hardware internal keying
enable_internal_keying = true
# Keyer level (0-255, 255 = fully visible overlay)
keyer_level = 255
# DeckLink output config paths (auto-selected based on input resolution)
# config_path_1080p = "configs/dev_1080p60_yuv422_fp16_trt.toml"
# config_path_4k = "configs/dev_4k30_yuv422_fp16_trt.toml"

# ═══════════════════════════════════════════════════════════════════════════
# PERFORMANCE SETTINGS
# ═══════════════════════════════════════════════════════════════════════════
[performance]
# GPU buffer pool size for overlay rendering
gpu_buffer_pool_size = 10
# Enable GPU buffer reuse
gpu_buffer_reuse = true
# Print detailed timing breakdown
print_detailed_timings = true
# Print per-frame latency information
print_per_frame_latency = true

# ═══════════════════════════════════════════════════════════════════════════
# CLASS LABELS
# ═══════════════════════════════════════════════════════════════════════════
[classes]
# Class labels (in order of class ID)
labels = ["Hyper", "Neo"]
# Mode labels for full UI (optional)
modes = ["COLON", "EGD"]
