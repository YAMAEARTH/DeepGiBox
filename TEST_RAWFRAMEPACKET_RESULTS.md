# à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š RawFramePacket

## à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸—à¸”à¸ªà¸­à¸šà¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™

### 1. `test_rawframepacket.rs` 
à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸—à¸”à¸ªà¸­à¸šà¸ˆà¸£à¸´à¸‡à¸—à¸µà¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š DeckLink device à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ RawFramePacket

**à¸§à¸´à¸˜à¸µà¸£à¸±à¸™:**
```bash
cargo run -p playgrounds --bin test_rawframepacket
```

**à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´:**
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸­à¸¸à¸›à¸à¸£à¸“à¹Œ DeckLink à¸—à¸µà¹ˆà¸¡à¸µà¹ƒà¸™à¸£à¸°à¸šà¸š
- à¹€à¸›à¸´à¸” capture session à¹à¸¥à¸°à¸­à¹ˆà¸²à¸™à¹€à¸Ÿà¸£à¸¡
- à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ RawFramePacket à¹à¸šà¸šà¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (PixelFormat, ColorSpace, stride, data size, etc.)
- à¸ˆà¸±à¸šà¹€à¸Ÿà¸£à¸¡à¹„à¸”à¹‰à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 3 à¹€à¸Ÿà¸£à¸¡ à¸«à¸£à¸·à¸­ timeout à¸«à¸¥à¸±à¸‡ 100 à¸„à¸£à¸±à¹‰à¸‡

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¹„à¸”à¹‰:**
```
Available DeckLink devices: 4
  [0] DeckLink 8K Pro (1)
  [1] DeckLink 8K Pro (2)
  [2] DeckLink 8K Pro (3)
  [3] DeckLink 8K Pro (4)
```

### 2. `demo_rawframepacket.rs` âœ… (à¸—à¸³à¸‡à¸²à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ)
à¹‚à¸›à¸£à¹à¸à¸£à¸¡ demo à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡ mock RawFramePacket à¹€à¸à¸·à¹ˆà¸­à¹à¸ªà¸”à¸‡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹à¸¥à¸°à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š

**à¸§à¸´à¸˜à¸µà¸£à¸±à¸™:**
```bash
cargo run -p playgrounds --bin demo_rawframepacket
```

**à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´:**
- à¸ªà¸£à¹‰à¸²à¸‡ mock RawFramePacket à¸ˆà¸³à¸¥à¸­à¸‡ (1920x1080 YUV422)
- à¹à¸ªà¸”à¸‡à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š table à¸ªà¸§à¸¢à¸‡à¸²à¸¡
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ 8 à¸‚à¹‰à¸­ à¸•à¸²à¸¡ INSTRUCTION.md
- à¹à¸ªà¸”à¸‡à¸‚à¸™à¸²à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¸° statistics

## à¸œà¸¥à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š

### âœ… à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ RawFramePacket à¸—à¸µà¹ˆà¹„à¸”à¹‰

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RawFramePacket                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘
â•‘ ğŸ“¦ FrameMeta:
â•‘    â”œâ”€ source_id      : 0
â•‘    â”œâ”€ frame_idx      : 42
â•‘    â”œâ”€ dimensions     : 1920x1080 pixels
â•‘    â”œâ”€ pixel_format   : YUV422_8              âœ…
â•‘    â”œâ”€ colorspace     : BT709                 âœ…
â•‘    â”œâ”€ stride_bytes   : 3840 bytes/row        âœ…
â•‘    â”œâ”€ pts_ns         : 1234567890123456789   âœ…
â•‘    â””â”€ t_capture_ns   : 1759757676952820138   âœ…
â•‘
â•‘ ğŸ’¾ MemRef (data):
â•‘    â”œâ”€ location       : Cpu                   âœ…
â•‘    â”œâ”€ ptr            : 0x70d16b40b010        âœ…
â•‘    â”œâ”€ len            : 4147200 bytes (3.96 MB)
â•‘    â””â”€ stride         : 3840 bytes/row
â•‘
â•‘ ğŸ“Š Statistics:
â•‘    â”œâ”€ total pixels   : 2073600
â•‘    â”œâ”€ bytes/pixel    : 2 (YUV422)
â•‘    â”œâ”€ expected min   : 4147200 bytes
â•‘    â””â”€ actual size    : 4147200 bytes         âœ…
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### âœ… à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ (8/8 à¸œà¹ˆà¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)

```
âœ“ [1] PixelFormat is YUV422_8 (8-bit YUV UYVY format)
âœ“ [2] ColorSpace is BT709 (HD standard)
âœ“ [3] Dimensions are valid: 1920x1080
âœ“ [4] Stride is valid: 3840 bytes (>= 3840 minimum)
âœ“ [5] Data size matches: 4147200 bytes (stride Ã— height)
âœ“ [6] Data is in CPU memory (as captured from DeckLink)
âœ“ [7] Data pointer is valid (not null)
âœ“ [8] Timestamps are populated (pts_ns and t_capture_ns)
```

## à¸ªà¸£à¸¸à¸›

### âœ… à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§

1. **à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ RawFramePacket à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡** - à¸•à¸£à¸‡à¸•à¸²à¸¡ spec à¹ƒà¸™ INSTRUCTION.md à¸—à¸¸à¸à¸›à¸£à¸°à¸à¸²à¸£
2. **FrameMeta à¸„à¸£à¸šà¸–à¹‰à¸§à¸™** - à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸ªà¸³à¸«à¸£à¸±à¸š pipeline
3. **PixelFormat: YUV422_8** - à¸£à¸¹à¸›à¹à¸šà¸šà¸—à¸µà¹ˆ DeckLink à¸ªà¹ˆà¸‡à¸¡à¸² (UYVY)
4. **ColorSpace: BT709** - à¸¡à¸²à¸•à¸£à¸à¸²à¸™ HD à¸ªà¸³à¸«à¸£à¸±à¸š 1080p60 à¹à¸¥à¸° 4K30
5. **MemRef à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡** - à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡, à¸‚à¸™à¸²à¸”, stride à¹à¸¥à¸° location à¸„à¸£à¸š
6. **Timestamps** - à¸šà¸±à¸™à¸—à¸¶à¸ pts_ns à¹à¸¥à¸° t_capture_ns
7. **Data size à¸•à¸£à¸‡à¸à¸±à¸™** - stride Ã— height = data.len

### ğŸ”„ à¸à¸£à¹‰à¸­à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š Stage à¸–à¸±à¸”à¹„à¸›

`decklink_input` à¸ªà¹ˆà¸‡ `RawFramePacket` à¸—à¸µà¹ˆà¸à¸£à¹‰à¸­à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š `PreprocessCUDA` à¹à¸¥à¹‰à¸§:

```rust
DeckLinkInput â†’ RawFramePacket {
    meta: FrameMeta {
        pixfmt: YUV422_8,        // âœ… à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸¥à¸·à¸­à¸ kernel
        colorspace: BT709,       // âœ… à¸ªà¸³à¸«à¸£à¸±à¸š color conversion coefficients
        stride_bytes: 3840,      // âœ… à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¹ˆà¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
        width: 1920, height: 1080, // âœ… à¸ªà¸³à¸«à¸£à¸±à¸š resize
        frame_idx, pts_ns, t_capture_ns, // âœ… à¸ªà¸³à¸«à¸£à¸±à¸š tracking
    },
    data: MemRef {
        ptr: 0x...,              // âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ YUV422
        len: 4147200,            // âœ… à¸‚à¸™à¸²à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
        stride: 3840,            // âœ… bytes à¸•à¹ˆà¸­à¹à¸–à¸§
        loc: Cpu,                // âœ… à¸à¸£à¹‰à¸­à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š H2D copy
    }
}
```

### ğŸ“ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡

**à¸‚à¸™à¸²à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ YUV422:**
- 1920Ã—1080: 3.96 MB à¸•à¹ˆà¸­à¹€à¸Ÿà¸£à¸¡
- 3840Ã—2160 (4K): 15.82 MB à¸•à¹ˆà¸­à¹€à¸Ÿà¸£à¸¡
- Stride: width Ã— 2 bytes (UYVY format)

**Pipeline à¸–à¸±à¸”à¹„à¸›:**
```
PreprocessCUDA à¸£à¸±à¸š RawFramePacket à¹à¸¥à¸°:
1. cudaMemcpy H2D (CPU â†’ GPU)
2. YUV422â†’RGB conversion kernel (BT.709 coefficients)
3. Resize to model input size (e.g., 640Ã—640)
4. Normalize (0-255 â†’ 0.0-1.0 or mean/std)
5. Output: TensorInputPacket (NCHW FP16/FP32 on GPU)
```
